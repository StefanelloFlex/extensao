var firstTime=!0,location=void 0,redmineToken=void 0,checkObservadas=!1,listaObservadas=[],checkNome=!1,listaNome=[];function callback(e){chrome.storage.local.get(["location"],(function(e){location=e.location})),location&&chrome.tabs.create({url:"http://"+location+"/redmine/issues/"+e})}function notificar(e,t){let s={type:"basic",title:"#"+e.id+" - "+e.subject,iconUrl:"128.png"};1==t?s.message="Mudou para a situação:\n":2==t&&(s.message="Foi atribuído à você.\n"),s.message+=e.status_name,chrome.notifications.create(e.id.toString(),s)}function watchIssues(){chrome.storage.local.get(["location","redmineToken","checkObservadas","checkNome"],(function(e){location=e.location,redmineToken=e.redmineToken,checkObservadas=e.checkObservadas,checkNome=e.checkNome}));try{if(!location)return;if(!redmineToken)return;var e={headers:{"X-Redmine-API-Key":redmineToken}},t=[];checkObservadas&&fetch("http://"+location+"/redmine/issues.json?set_filter=1&watcher_id=me&limit=100",e).then(e=>e.json()).then(e=>{listaObservadas.forEach(s=>{e.issues.forEach(e=>{s.id!=e.id||t.push(s)})}),e.issues.forEach(e=>{let s=!0;for(let i=0;i<t.length;i++){const a=t[i];if(a.id==e.id)return s=!1,void(a.status!=e.status.id&&(t[i].status=e.status.id,t[i].status_name=e.status.name,notificar(t[i],1)))}if(s){let s={id:e.id,subject:e.subject,status:e.status.id,status_name:e.status.name};t.push(s)}}),listaObservadas=t});var s=[];checkNome&&fetch("http://"+location+"/redmine/issues.json?set_filter=1&assigned_to_id=me&status_id=o&limit=100",e).then(e=>e.json()).then(e=>{listaNome.forEach(t=>{e.issues.forEach(e=>{t.id!=e.id||s.push(t)})}),e.issues.forEach(e=>{let t=!0;for(let i=0;i<s.length;i++){if(s[i].id==e.id)return void(t=!1)}if(t){let t={id:e.id,subject:e.subject,status:e.status.id,status_name:e.status.name};s.push(t),firstTime||notificar(t,2)}}),firstTime=!1,listaNome=s})}finally{setTimeout(watchIssues,1e4)}}chrome.notifications.onClicked.addListener(callback),watchIssues();